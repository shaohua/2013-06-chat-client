<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chat with JSON!</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="vendor/jquery/jquery-1.9.1.js"></script>
    <script src="js/setup.js"></script>
  </head>
  <body>

    <div id="main">
      <h1>Chat with JSON!</h1>
    </div>
    <script>


    // var rooms = {};
    // rooms.addRoom = function(room_name){
    //   var room = {
    //     room_name:room_name
    //   };
    //   return room;
    // };
    // rooms.removeRoom = function(){

    // };
    // rooms.displayRoom = function(room_name){

    // };

    var room = {
      room_name: "wild party room",
      display: function(){
        $('body').append('<div class="room1"></div>');
        $('.room1').append('<h3 class="room_name">' +
            this.room_name + '</h3>');
      },
      fetch_msg: function(){
        var that = this;
        $.ajax({
          url:'https://api.parse.com/1/classes/test'
        }).done(function(data){

          //console.log('data: ', data);
          var parse_data = function(data){
            // console.log('---\n');
            var results = data.results;
            for(var i=0; i<results.length; i++){
              // console.log(results[i].text);
              $('.room1').append(results[i].text).append('<br>');
            }
          };

          parse_data(data);

        });
      }
    };

    room.display();
    room.fetch_msg();
    var msg = JSON.stringify({key1:'value1'});

    var user = {
      user_name: window.location.search.split('?username=')[1],
      newmessage: function(message){
        var request = $.ajax(
          'https://api.parse.com/1/classes/test',
        {
          contentType: 'application/json',
          type: "POST",
          data: msg,
          success: function(data) {
            console.log('data: ', data);
          },
          error: function(data) {
            console.log('error', data);
          }
        });
        // request.done(function(message){
        //   console.log('done', message);
        // });
        // request.fail(function(jqXHR, textStatus){
        //   // debugger;
        //   console.log('request failed' + textStatus + jqXHR.responseText);
        // });
      }
    };

    user.newmessage('dd');

    room.fetch_msg();


    </script>

  </body>
</html>
