<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Chat with JSON!</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="vendor/jquery/jquery-1.9.1.js"></script>
    <script src="js/setup.js"></script>
  </head>
  <body>

    <div id="main">
      <h1>Chat with JSON!</h1>
    </div>
    <script>


    // var rooms = {};
    // rooms.addRoom = function(room_name){
    //   var room = {
    //     room_name:room_name
    //   };
    //   return room;
    // };
    // rooms.removeRoom = function(){

    // };
    // rooms.displayRoom = function(room_name){

    // };

    var room = {
      room_name: "wild party room",
      display: function(){
        $('body').append('<div class="room1"></div>');
        $('.room1').append('<h3 class="room_name">' +
            this.room_name + '</h3>');
      },
      fetch_msg: function(){
        var that = this;
        $.ajax({
          url:'https://api.parse.com/1/classes/messages'
        }).done(function(data){

          console.log('data: ', data);
          var parse_data = function(data){
            var results = data.results;
            for(var i=0; i<results.length; i++){
              $('.room1').append(results[i].text).append('<br>');
            }
          };

          parse_data(data);

        });
      },
      fetch_msg_wild_party:function(){
        var that = this;
        $.ajax({
          url:'https://api.parse.com/1/classes/wild_party_room'
        }).done(function(data){

          console.log('data: ', data);
          var parse_data = function(data){
            // console.log('---\n');
            var results = data.results;
            for(var i=0; i<results.length; i++){
              $('.room1').append(results[i].key1).append('<br>');
            }
          };

          parse_data(data);

        });


      }
    };

    room.display();

    var user = {
      user_name: window.location.search.split('?username=')[1],
      newmessage: function(message){
        //expect message as a obj with key-value pairs
        var msg = JSON.stringify(message);

        var request = $.ajax({
          url:'https://api.parse.com/1/classes/messages',
          type: "POST",
          data: msg,
          contentType: 'application/json'
        });

        request.done(function(message){
          console.log('done', message);
        });

        request.fail(function(jqXHR, textStatus){
          console.log('request failed' + textStatus + jqXHR.responseText);
        });
      }
    };

    user.newmessage({
      username: 'shawndrost',
      text: 'trolodddddddddddddddddddddddddddddddddlo'
    });

    room.fetch_msg();


    </script>

  </body>
</html>
